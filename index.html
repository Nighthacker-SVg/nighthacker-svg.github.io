import React, { useState, useEffect, useRef } from "react";
import { Copy, Check, Mail, Phone, Linkedin, Terminal, User, FileText } from "lucide-react";

/**
 * Custom Dithering Component (The Visual Core)
 */
const Dithering = ({ colorBack, colorFront, className }) => {
  const canvasRef = useRef(null);
  const requestRef = useRef();
  const timeRef = useRef(0);

  const bayerMatrix = [
    [0, 8, 2, 10],
    [12, 4, 14, 6],
    [3, 11, 1, 9],
    [15, 7, 13, 5],
  ];

  useEffect(() => {
    const canvas = canvasRef.current;
    const ctx = canvas.getContext("2d", { alpha: false });
    
    // Low res for retro feel
    const w = 64; 
    const h = 64;
    canvas.width = w;
    canvas.height = h;

    const parseHsl = (str) => {
        const match = str.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);
        if (match) return { h: parseInt(match[1]), s: parseInt(match[2]), l: parseInt(match[3]) };
        return { h: 0, s: 0, l: 0 }; // default
    };

    const animate = () => {
      timeRef.current += 0.015;
      const t = timeRef.current;

      const backColor = parseHsl(colorBack);
      const frontColor = parseHsl(colorFront);

      const imgData = ctx.createImageData(w, h);
      const data = imgData.data;

      for (let y = 0; y < h; y++) {
        for (let x = 0; x < w; x++) {
          const nx = (x / w) * 2 - 1;
          const ny = (y / h) * 2 - 1;
          
          const cx = Math.sin(t * 1.2) * 0.3;
          const cy = Math.cos(t * 0.9) * 0.3;
          const dist = Math.sqrt((nx - cx) * (nx - cx) + (ny - cy) * (ny - cy));
          
          const radius = 0.6 + Math.sin(Math.atan2(ny, nx) * 5 + t * 2) * 0.1;
          let value = 1.0 - smoothstep(radius - 0.2, radius + 0.2, dist);

          const threshold = bayerMatrix[y % 4][x % 4] / 16.0;
          const isFront = (value + (threshold - 0.5) * 0.5) > 0.5;

          const index = (y * w + x) * 4;
          
          if (isFront) {
              if (frontColor.s === 0 && frontColor.l === 100) {
                  data[index] = 255; data[index+1] = 255; data[index+2] = 255;
              } else if (frontColor.h === 220) {
                   data[index] = 100; data[index + 1] = 149; data[index + 2] = 237;
              } else {
                   data[index] = 0; data[index + 1] = 255; data[index + 2] = 128;
              }
          } else {
             const val = backColor.l > 50 ? 245 : 10;
             data[index] = val; data[index + 1] = val; data[index + 2] = val;
          }
          data[index + 3] = 255;
        }
      }

      ctx.putImageData(imgData, 0, 0);
      requestRef.current = requestAnimationFrame(animate);
    };

    requestRef.current = requestAnimationFrame(animate);
    return () => cancelAnimationFrame(requestRef.current);
  }, [colorBack, colorFront]);

  function smoothstep(min, max, value) {
    var x = Math.max(0, Math.min(1, (value - min) / (max - min)));
    return x * x * (3 - 2 * x);
  }

  return (
    <canvas
      ref={canvasRef}
      className={className}
      style={{ width: "100%", height: "100%", imageRendering: "pixelated" }}
    />
  );
};

export default function ResumePage() {
  const [isDarkMode, setIsDarkMode] = useState(true);
  const [copied, setCopied] = useState(false);
  const [activeTab, setActiveTab] = useState('resume'); 

  const handleCopy = () => {
    navigator.clipboard.writeText("Hirentank70@gmail.com");
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };

  return (
    <div className={`relative min-h-screen flex flex-col md:flex-row font-mono transition-colors duration-500 ${isDarkMode ? "bg-black" : "bg-white"}`}>
      
      {/* --- Left Panel: Content --- */}
      <div
        className={`w-full md:w-1/2 p-8 md:p-12 lg:p-16 flex flex-col relative z-10 transition-colors duration-500 ${
          isDarkMode ? "text-white" : "text-black"
        }`}
      >
        {/* Navigation */}
        <nav className={`fixed top-0 left-0 w-full md:w-1/2 z-50 px-8 py-6 backdrop-blur-md border-b ${isDarkMode ? "border-white/10 bg-black/80" : "border-black/10 bg-white/80"}`}>
            <div className="flex items-center justify-between">
                <span className="font-bold tracking-tighter text-lg">HT.</span>
                <div className="flex gap-4 md:gap-6 text-xs md:text-sm">
                    <button 
                        onClick={() => setActiveTab('resume')} 
                        className={`flex items-center gap-2 hover:opacity-100 transition-opacity ${activeTab === 'resume' ? 'opacity-100 font-bold' : 'opacity-60'}`}
                    >
                        <User size={14}/> Resume
                    </button>
                    <button 
                        onClick={() => setActiveTab('darknots')}
                        className={`flex items-center gap-2 hover:opacity-100 transition-opacity ${activeTab === 'darknots' ? 'opacity-100 font-bold' : 'opacity-60'}`}
                    >
                        <FileText size={14}/> DarkNots
                    </button>
                </div>
                <button
                    onClick={() => setIsDarkMode(!isDarkMode)}
                    className="p-2 rounded-full hover:bg-current/10 transition-colors"
                >
                    {isDarkMode ? "☼" : "☾"}
                </button>
            </div>
        </nav>

        {/* Main Content */}
        <div className="mt-20 md:mt-24 space-y-12 pb-24">
          
          {/* --- TAB: RESUME --- */}
          {activeTab === 'resume' && (
            <>
                <section className="border-b border-current/20 pb-8">
                    <h1 className="text-4xl md:text-5xl font-bold tracking-tight uppercase mb-4">HIREN TANK</h1>
                    <div className="space-y-2 text-sm md:text-base opacity-80">
                        <div className="flex items-center gap-3">
                            <Mail size={16} /> 
                            <span>Hirentank70@gmail.com</span>
                        </div>
                        <div className="flex items-center gap-3">
                            <Phone size={16} /> 
                            <span>+91 9714496423</span>
                        </div>
                        <div className="flex items-center gap-3">
                            <Linkedin size={16} /> 
                            <span>LinkedIn</span>
                        </div>
                    </div>
                </section>

                <section>
                    <h2 className="text-xl font-bold uppercase mb-4 tracking-widest border-l-4 border-current pl-4">Summary</h2>
                    <p className="opacity-80 leading-relaxed text-sm md:text-base">
                        Proactive and Certified Entry-Level Cyber Analyst with deep practical skills in Security Operations (SOC) and Threat Detection. Proven ability to execute vulnerability assessments (Nmap, Burp Suite) and develop defensive controls (Snort IDS rules). Proficient in SIEM fundamentals and data analysis using Splunk and Google Security Operations platforms. Eager to contribute hands-on technical skills in a Cyber Security Intern, Associate, or SOC Analyst role.
                    </p>
                </section>

                <section>
                    <h2 className="text-xl font-bold uppercase mb-4 tracking-widest border-l-4 border-current pl-4">Technical Skills</h2>
                    <div className="space-y-4 text-sm md:text-base opacity-80">
                        <p><strong>SOC & Detection:</strong> Splunk (Fundamentals), Google Security Operations, Snort, Wireshark, Incident Monitoring, Threat Detection, Data Analysis.</p>
                        <p><strong>Security Tools:</strong> Nmap, Metasploit, Burp Suite, SQL Map, Ghauri, Shodan.</p>
                        <p><strong>Vulnerability Mgmt:</strong> Vulnerability Assessment, Reconnaissance, Threat Modeling, Containerization (Docker).</p>
                        <p><strong>OS & Scripting:</strong> Kali Linux, Windows, Python (Basic Scripting, Automation), Bash (Terminal Commands).</p>
                    </div>
                </section>

                <section>
                    <h2 className="text-xl font-bold uppercase mb-4 tracking-widest border-l-4 border-current pl-4">Key Projects & Hands-On</h2>
                    <div className="space-y-8">
                        <div>
                            <h3 className="font-bold text-lg mb-2">1. Vulnerability Assessment & Reporting Simulation</h3>
                            <ul className="list-disc list-inside space-y-2 text-sm md:text-base opacity-80 pl-2">
                                <li>Executed network enumeration and reconnaissance across simulated internal infrastructure using Nmap to identify over 15 open ports, services, and associated vulnerabilities.</li>
                                <li>Identified and exploited common security flaws (FTP misconfigurations, LFI/command execution) to demonstrate potential unauthorized access.</li>
                                <li>Reported findings in a detailed technical assessment, summarizing impact, assigning risk levels, and providing prioritized remediation recommendations.</li>
                            </ul>
                        </div>
                        <div>
                            <h3 className="font-bold text-lg mb-2">2. Intrusion Detection System (IDS) Rule Development</h3>
                            <ul className="list-disc list-inside space-y-2 text-sm md:text-base opacity-80 pl-2">
                                <li>Developed and validated Snort rules to achieve high-fidelity detection of specific network attack signatures and suspicious traffic patterns (e.g., simple brute force and malware-like beaconing).</li>
                                <li>Analyzed captured network traffic and logs to confirm rule efficacy, ensuring accurate alert generation for potential security incidents.</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <section>
                    <h2 className="text-xl font-bold uppercase mb-4 tracking-widest border-l-4 border-current pl-4">Achievements</h2>
                    <div className="mb-4">
                        <h3 className="font-bold text-lg">TryHackMe (THM) - Top 4% Rank</h3>
                        <ul className="list-disc list-inside space-y-2 mt-2 text-sm md:text-base opacity-80 pl-2">
                            <li>Completed over 100 rooms across key security domains, including Penetration Testing, Privilege Escalation, Web Exploitation, and SOC Analysis.</li>
                            <li>Achieved a global rank in the Top 4% (Rank: 52,937), demonstrating consistent high engagement and skill development.</li>
                        </ul>
                    </div>
                </section>

                <section>
                    <h2 className="text-xl font-bold uppercase mb-4 tracking-widest border-l-4 border-current pl-4">Professional Experience</h2>
                    <div>
                        <div className="flex flex-col md:flex-row justify-between mb-2">
                            <h3 className="font-bold text-lg">Cyber Security Intern | Demmisto Technologies</h3>
                            <span className="text-sm opacity-70">December 2023 - June 2024 (7 Months)</span>
                        </div>
                        <p className="text-sm opacity-70 mb-4">Ahmedabad, Gujarat</p>
                        <ul className="list-disc list-inside space-y-2 text-sm md:text-base opacity-80 pl-2">
                            <li>Configured and maintained virtualized lab environments (e.g., using Docker) used for internal security training initiatives and new tool evaluation.</li>
                            <li>Supported technical operations and contributed to research and development of practical security lab exercises for corporate training initiatives.</li>
                        </ul>
                    </div>
                </section>
                
                <section>
                    <h2 className="text-xl font-bold uppercase mb-4 tracking-widest border-l-4 border-current pl-4">Education</h2>
                    <div className="space-y-6">
                        <div>
                            <h3 className="font-bold text-lg">Bachelor of Technology in Cyber Security</h3>
                            <p className="opacity-80">Gandhinagar University | Gandhinagar, Gujarat</p>
                            <p className="text-sm opacity-60 mt-1">Expected Graduation: 2026</p>
                        </div>
                        <div>
                            <h3 className="font-bold text-lg">Diploma in Information Technology</h3>
                            <p className="opacity-80">Silver Oak University | Ahmedabad, Gujarat</p>
                            <p className="text-sm opacity-60 mt-1">Graduated: 2024</p>
                        </div>
                    </div>
                </section>

                <section>
                   <h2 className="text-xl font-bold uppercase mb-4 tracking-widest border-l-4 border-current pl-4">Certifications</h2>
                   <div className="mb-6">
                      <h3 className="font-bold text-lg mb-2 underline decoration-1 underline-offset-4">Security Operations & Industry Programs</h3>
                      <ul className="list-disc list-inside space-y-1 text-sm md:text-base opacity-80 pl-2">
                          <li>Google Security Operations - Deep Dive / Fundamentals</li>
                          <li>Microsoft Student SOC Program (Coursework Completed)</li>
                          <li>Learning Splunk Course Completion</li>
                          <li>Datacom / Deloitte Australia - Cyber Job Simulations (Forage)</li>
                      </ul>
                   </div>
                   <div>
                      <h3 className="font-bold text-lg mb-2 underline decoration-1 underline-offset-4">Core & Foundational Certifications</h3>
                      <ul className="list-disc list-inside space-y-1 text-sm md:text-base opacity-80 pl-2">
                          <li>Certified Information Security and Ethical Hacker (CISEH) by Pristine InfoSolutions</li>
                          <li>Ethical Hacking Essentials (EHE) by EC-Council</li>
                          <li>Network Analysis by Security Blue Team</li>
                      </ul>
                   </div>
                </section>
            </>
          )}

          {/* --- TAB: DARKNOTS (Blank) --- */}
          {activeTab === 'darknots' && (
              <div className="h-full flex flex-col space-y-8">
                  <div className="border-b border-current/20 pb-4">
                      <h2 className="text-2xl font-bold uppercase tracking-widest mb-2 flex items-center gap-2">
                          <Terminal size={24} /> DarkNots
                      </h2>
                      <p className="opacity-60 text-sm">Security research, CTF write-ups, and anomaly logs.</p>
                  </div>
                  
                  {/* Blank State */}
                  <div className="flex-1 flex items-center justify-center opacity-40 text-sm font-mono">
                      <p>/// NO ENTRIES FOUND ///</p>
                  </div>
              </div>
          )}

        </div>

        {/* Footer */}
        <div className="fixed bottom-0 left-0 w-full md:w-1/2 p-6 bg-inherit border-t border-current/10 flex justify-between items-center text-sm opacity-60 z-50">
            <span>© 2026 Hiren Tank</span>
            <button onClick={handleCopy} className="flex items-center gap-2 hover:opacity-100 transition-opacity">
                {copied ? <Check size={14} /> : <Copy size={14} />}
                <span>Copy Email</span>
            </button>
        </div>
      </div>

      {/* --- Right Panel: Visual/Shader (Sticky) --- */}
      <div className="hidden md:block w-1/2 h-screen sticky top-0 border-l border-white/10 overflow-hidden">
        <div className="absolute inset-0">
          <Dithering
            className="w-full h-full object-cover"
            colorBack={isDarkMode ? "hsl(0, 0%, 5%)" : "hsl(0, 0%, 95%)"}
            colorFront={isDarkMode ? "hsl(0, 0%, 100%)" : "hsl(220, 100%, 60%)"}
          />
        </div>
        
        {/* Overlay Text */}
        <div className={`absolute bottom-12 right-12 text-right pointer-events-none mix-blend-difference ${isDarkMode ? "text-white" : "text-white"}`}>
            <span className="block text-[8rem] font-black tracking-tighter leading-none opacity-90">
                HIREN TANK
            </span>
            <span className="block text-2xl font-bold tracking-widest mt-4 opacity-80">
                @NIGHTHACKER
            </span>
        </div>
      </div>

       {/* Mobile Visual */}
       <div className="md:hidden h-[30vh] relative border-t border-white/10">
            <Dithering
                className="w-full h-full object-cover"
                colorBack={isDarkMode ? "hsl(0, 0%, 5%)" : "hsl(0, 0%, 95%)"}
                colorFront={isDarkMode ? "hsl(0, 0%, 100%)" : "hsl(220, 100%, 60%)"}
            />
       </div>

    </div>
  );
}